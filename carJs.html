<!DOCTYPE html>
<html>
<head>
	<title>Simple Catalog JS</title>
	<script type="text/javascript" src="mustache.js"></script>
</head>
<body onload="cartJS.init(cartOptions)">
<div class="proListing"></div>
<div class="cart"></div>
<script id="listingTemp" type="text/template">
{{#products}}
<div class="product" id="{{id}}">
	{{#image}}
		<div class="ProImg">
			<div class="img"><img src="{{image}}" alt="{{name}}" title="{{name}}"/></div>
		</div>
	{{/image}}
	{{^image}}
		<div class="ProImg">
			<div class="img"><img src="http://placehold.it/150x150" alt="{{name}}" title="{{name}}"/></div>
		</div>
	{{/image}}
	<div class="productName">
		{{name}}
	</div>
	<div class="productPrice">
		{{price}}{{currency}}
	</div>
	<div class="options">
		<button onclick="cartJS.updateCart({{id}})">Add to cart</button>
	</div>
	
</div>
{{/products}}
</script>
<script id="cartTemp" type="text/template">
	<div class="cartDropDown">
	{{#products}}
	{{id}} {{image}} {{name}} {{price}} {{qty}}
	{{/products}}
	</div>
</script>



<script type="text/javascript">
cartOptions = {
	listingHtmlTemplate: document.getElementById('listingTemp').innerHTML, // Mustache script template , You can use jQuery also
	appendListingTo: document.getElementsByClassName('proListing')[0], //target html object , You can use jQuery also
	cartHtmlTemplate: document.getElementById('cartTemp').innerHTML, // Mustache script template, You can use jQuery also
	cartHtmlObject:document.getElementsByClassName('cart')[0],
	currency:'$',
	products: [{"name":"Product 1","id":12,"price":12,"image":"http://placehold.it/350x150"},{"name":"Product 2","id":2,"price":20,"image":""}]
}

cartJS = {
	init:function(cartOptions){
		var self = this;
		var products = cartOptions.products;
		typeof console == "object" ? self.consoleReady = true : self.consoleReady == false
			
		if(!self.validateProductsJson(products)){
			self.consoleLog('error','Please revise the products JSON object');
		}
		else{
			self.renderProductTemplate(products,cartOptions.listingHtmlTemplate,cartOptions.appendListingTo,cartOptions.currency);
		}

	},
	renderProductTemplate:function(products,template,target,currency){
		if(template.length == 0 && target.length == 0){
			self.consoleLog('error','There is No Template/Listing');
			return;
		}
		Mustache.parse(template);   // optional, speeds up future uses
		var rendered = Mustache.render(template, {products : products,currency:currency});
		target.innerHTML = rendered;
	},
	updateCart:function(id){
		var self = this;
		if(typeof JsonCart == "undefined"){
			JsonCart = new Array;
		}
		if(self.getProductbyProperty(JsonCart,'id',id)){
			var cartProduct = self.getProductbyProperty(JsonCart,'id',id);
			cartProduct.qty++;
		}else{
			product = self.getProductbyProperty(cartOptions.products,'id',id);
			product.qty = 1;
			JsonCart.push(product)
		}
		var cartTemplate = cartOptions.cartHtmlTemplate;
		var cartHtmlTarget = cartOptions.cartHtmlObject;
		var currency = cartOptions.currency;
		self.renderProductTemplate(JsonCart,cartTemplate,cartHtmlTarget,currency)
	},
	validateProductsJson:function(products){
		var self = this;
		var validateThese = ['name','id','price','image'];
		if(products.length > 0){
			for(i in products){
				for (var x = 0; x < validateThese.length; x++) {
					if(!products[i].hasOwnProperty(validateThese[x])){
						self.consoleLog('warn',"product #"+ i +" doesn't have "+validateThese[x]);
						return false;
					}
				}
				i++;
			}
			return true;
		}else{
			return false;
		}
	},
	consoleLog:function(type,message){
		if(self.consoleReady == true){
			console[type]('Simple Catalog : ' + message);
		}
		else{
			alert(message);
		}
	},
	getProductbyProperty:function(obj,prop,value){//helper
		var self = this;
		for (var i = obj.length - 1; i >= 0; i--) {
			if(obj[i][prop] == value){
				return obj[i];
			}
		};
	}
}

</script>
</body>
</html>